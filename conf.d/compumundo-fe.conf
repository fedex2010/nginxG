server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    include /etc/nginx/security/*-ips.conf;
    deny all;

    listen 80;
    server_name backoffice-ci.compumundo.com backoffice-staging.compumundo.com backoffice.compumundo.com;

    set $webstore compumundo;
    include /etc/nginx/includes/headers;

    location / {
        proxy_pass $backoffice_ui_us;
    }
}

server {
    listen 80;
    server_name compumundo.com compumundo.com.ar www.compumundo.com ;
    location / {
        rewrite ^ https://www.compumundo.com.ar$request_uri permanent;
    }
    location /carrito {
        rewrite ^ https://www.compumundo.com.ar/carrito/ permanent;
    }

    location /compra {
        rewrite ^ https://www.compumundo.com.ar/compra/ permanent;
    }

    location /pagos {
        rewrite ^ https://www.compumundo.com.ar/pagos/ permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name www.compumundo.com.ar *.compumundo.com.ar *.compumundo.com;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/compu-no-pwa/product.compu/locations.conf;
    include /etc/nginx/compu-no-pwa/home.compu/locations.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;
    include /etc/nginx/compu-no-pwa/listing.compu/locations.conf;
    include /etc/nginx/fe/my-account.prod/locations.conf;

    location ~ /cybermonday$ {
        proxy_pass $home_fe_us/;
    }

    location /comparador-productos {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /cybermondaySuscriptionService {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;
        include /etc/nginx/env.conf;

        proxy_pass $landings_fe_us;
    }

    location ~ ^/categorias {
            include /etc/nginx/includes/https;

            include /etc/nginx/includes/rewrites;
            include /etc/nginx/includes/compu-rewrites;
            proxy_pass $epi_ui_us;
        }

    location / {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    # New Compumundo Checkout redirects Production.
    location ~ ^/(compra|pagos) {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $checkout_ui_compumundo_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

    location /carrito/vendedor {
        proxy_pass $epi_ui_us;
    }

    location /trabaja-en-compumundo {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /seguros {
      include /etc/nginx/env.conf;
      proxy_pass $landings_fe_us;
    }

    location /suscripcionSeguros {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /techgo {
        #proxy_pass $landings_fe_us;
        return 301 $scheme://techgo.compumundo.com.ar;
    }

    location /tech-go {
        return 301 $scheme://www.techgo.com.ar;
    }

    location /hotsale {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /services/feeds {
        include /etc/nginx/env.conf;
        proxy_pass $product_core_us;
    }

    location /sucursales {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }
}

server {
    listen 80;
    server_name staging.compumundo.com;
    location / {
        rewrite ^ https://staging.compumundo.com.ar$request_uri permanent;
    }
    location ~ ^/user/password/recover {
       rewrite ^/user/password/recover(.*) https://compuprod.epi.ninja/user/password/recover$1 permanent;
    }
    location /carrito {
        rewrite ^ https://staging.compumundo.com.ar/carrito/ permanent;
    }

    location /compra {
        rewrite ^ https://staging.compumundo.com.ar/compra/ permanent;
    }

    location /pagos {
        rewrite ^ https://staging.compumundo.com.ar/pagos/ permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name staging.compumundo.com.ar;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/compu-no-pwa/product.compu/locations.conf;
    include /etc/nginx/compu-no-pwa/home.compu/locations.conf;
    include /etc/nginx/compu-no-pwa/listing.compu/locations.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;
    include /etc/nginx/fe/my-account.prod/locations.conf;

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location /comparador-productos {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /cybermonday {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /techgo {
        #proxy_pass $landings_fe_us;
        return 301 $scheme://techgo-staging.compumundo.com.ar;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/categorias {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    # New Compumundo Checkout redirects Staging.
    location ~ ^/(carrito|compra|pagos) {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $checkout_ui_compumundo_us;
    }

    location / {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

    location /trabaja-en-compumundo {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /seguros {
      include /etc/nginx/env.conf;
      proxy_pass $landings_fe_us;
    }

    location /suscripcionSeguros {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /hotsale {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location ~ "^/hotsale$" {
        include /etc/nginx/env.conf;
        proxy_pass $home_fe_us/;
    }

    location /services/feeds {
        include /etc/nginx/env.conf;
        proxy_pass $product_core_us;
    }

    location /sucursales {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }
}

#Ficha Compumundo CI
server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name ci.compumundo.com;

    location / {
        rewrite ^ https://ci.compumundo.com.ar$request_uri permanent;
    }

    location /carrito {
        rewrite ^ https://ci.compumundo.com.ar/carrito/ permanent;
    }

    location /compra {
        rewrite ^ https://ci.compumundo.com.ar/compra/ permanent;
    }

    location /pagos {
        rewrite ^ https://ci.compumundo.com.ar/pagos/ permanent;
    }

}

#Seguros
server {
    listen 80;
    server_name insurance-ci.compumundo.com.ar seguros.compumundo.com.ar;
    set $webstore compumundo;
    include /etc/nginx/includes/headers;
    include /etc/nginx/proxy_env.conf;
    location / {
        proxy_pass $landings_fe_us/seguros$request_uri;
    }
}

#Techgo.Compumundo
server {
    listen 80;
    include /etc/nginx/proxy_env.conf;
    server_name techgo.compumundo.com.ar;
    include /etc/nginx/includes/headers;
    include /etc/nginx/proxy_env.conf;

    location / {
        proxy_set_header Host techgo.compumundo.com.ar.s3-website-us-east-1.amazonaws.com;
        proxy_pass $techgo_us;
    }
}

#Techgo Canonical
server {
    listen 80;
    include /etc/nginx/proxy_env.conf;
    server_name www.techgo.com.ar;
    include /etc/nginx/includes/headers;
    include /etc/nginx/proxy_env.conf;

    location / {
        proxy_set_header Host techgo.compumundo.com.ar.s3-website-us-east-1.amazonaws.com;
        proxy_pass $techgo_us;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name ci.compumundo.com.ar;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/compu-no-pwa/product.compu/locations.conf;
    include /etc/nginx/compu-no-pwa/home.compu/locations.conf;
    include /etc/nginx/compu-no-pwa/listing.compu/locations.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;
    include /etc/nginx/fe/my-account.prod/locations.conf;

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ /cybermonday {
        proxy_pass $landings_fe_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location ~ ^/categorias {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location /comparador-productos {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    # New Compumundo Checkout redirects CI.
    location ~ ^/(carrito|compra|pagos) {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $checkout_ui_compumundo_us;
    }

    location / {
        # include /etc/nginx/includes/prerender;
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

    location /trabaja-en-compumundo {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /seguros {
      include /etc/nginx/env.conf;
      proxy_pass $landings_fe_us;
    }

    location /techgo {
        #proxy_pass $landings_fe_us;
        return 301 $scheme://techgo.compumundo.com.ar;
    }

    location /suscripcionSeguros {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /sucursales {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /hotsale {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /services/feeds {
        include /etc/nginx/env.conf;
        proxy_pass $product_core_us;
    }
}
