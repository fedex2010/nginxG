server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    include /etc/nginx/security/*-ips.conf;
    deny all;

    listen 80;
    server_name backoffice-ci.compumundo.com backoffice-staging.compumundo.com backoffice.compumundo.com;

    set $webstore compumundo;
    include /etc/nginx/includes/headers;

    location / {
        proxy_pass $backoffice_ui_us;
    }
}

server {
    listen 80;
    server_name compumundo.com compumundo.com.ar www.compumundo.com ;
    location / {
        rewrite ^ https://www.compumundo.com.ar$request_uri permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name www.compumundo.com.ar *.compumundo.com.ar *.compumundo.com;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/fe/product.prod/locations.conf;
    include /etc/nginx/fe/home.prod/locations.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;
    include /etc/nginx/fe/listing.prod/locations.conf;

    location ~ /cybermonday$ {
        rewrite ^ /cybermonday2016 break;
        proxy_pass $epi_ui_us;
    }

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location / {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }
            
    location /carrito/vendedor {
        proxy_pass $checkout_ui_us;
    }
}

#Ficha Compumundo STAGING
server {
    listen 80;
    server_name staging.compumundo.com;
    location / {
        rewrite ^ https://staging.compumundo.com.ar$request_uri permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name staging.compumundo.com.ar;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/fe/product.prod/*.conf;
    include /etc/nginx/fe/home.prod/*.conf;
    include /etc/nginx/fe/listing.prod/*.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location / {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }
}

#Ficha Compumundo CI
server {
    listen 80;
    server_name ci.compumundo.com;
    location / {
        rewrite ^ https://ci.compumundo.com.ar$request_uri permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name ci.compumundo.com.ar;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/fe/product.prod/*.conf;
    include /etc/nginx/fe/home.prod/*.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;
    include /etc/nginx/fe/listing.prod/locations.conf;

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location / {
        # include /etc/nginx/includes/prerender;
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

    location /seguros {
        include /etc/nginx/security/*-ips.conf;
        allow 12.19.20.201;
        allow 200.69.242.225;
        allow 208.70.235.9;
        allow 65.217.244.3;
        allow 181.118.255.179;
        allow 190.191.232.94;

        deny all;

        proxy_pass $landings_fe_us;
    }
}
