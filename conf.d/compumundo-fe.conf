server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    include /etc/nginx/security/*-ips.conf;
    deny all;

    listen 80;
    server_name backoffice-ci.compumundo.com backoffice-staging.compumundo.com backoffice.compumundo.com;

    set $webstore compumundo;
    include /etc/nginx/includes/headers;

    location / {
        proxy_pass $backoffice_ui_us;
    }
}

server {
    listen 80;
    server_name compumundo.com compumundo.com.ar www.compumundo.com ;
    location / {
        rewrite ^ https://www.compumundo.com.ar$request_uri permanent;
    }
    location /carrito {
        rewrite ^ https://www.compumundo.com.ar/carrito/ permanent;
    }

    location /compra {
        rewrite ^ https://www.compumundo.com.ar/compra/ permanent;
    }

    location /pagos {
        rewrite ^ https://www.compumundo.com.ar/pagos/ permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name www.compumundo.com.ar *.compumundo.com.ar *.compumundo.com;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/includes/atacks;
    #include /etc/nginx/compu-no-pwa/*.prod/locations.conf;
    include /etc/nginx/fe/normandia.prod/locations.conf;
    include /etc/nginx/fe/my-account.prod/locations.conf;
    include /etc/nginx/fe/landings.prod/landings.conf;
    include /etc/nginx/fe/newlandings.prod/locations.conf;
    include /etc/nginx/fe/prelanding.prod/location.conf;
    include /etc/nginx/fe/home.prod/*.conf;
    include /etc/nginx/fe/listing.prod/*.conf;
    include /etc/nginx/fe/product.prod/*.conf;
    include /etc/nginx/fe/pwa.prod/*.conf;
    include /etc/nginx/fe/checkout.prod/*.conf;
    include /etc/nginx/fe/301-compu.prod/locations.conf;

    location /cybermonday {
        proxy_pass $landings_fe_us;
        #return 302 https://www.compumundo.com.ar$is_args$args;
    }

 	location /ayuda {
 		rewrite ^/ayuda/?(.*) /$1 break;
 		proxy_pass $cac_frontend_us;
 	}

    location /html/faq {
        return 301 https://www.compumundo.com.ar/ayuda;
    }

    location /contactos/cac {
        return 301 https://www.compumundo.com.ar/ayuda;
    }

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location ~ ^/categorias {
            include /etc/nginx/includes/https;
            include /etc/nginx/includes/rewrites;
            include /etc/nginx/includes/compu-rewrites;
            proxy_pass $epi_ui_us;
        }

    location / {
        include /etc/nginx/includes/https;
        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    # New Compumundo Checkout redirects Production.
    #     location ~ ^/(carrito|compra|pagos) {
    #         include /etc/nginx/includes/https;
    # 
    #         include /etc/nginx/includes/rewrites;
    #         include /etc/nginx/includes/compu-rewrites;
    #         proxy_pass $checkout_ui_us;
    #     }

    #----Compumundo--- Nuevas Rutas
    location ~ ^/carrito {
        proxy_pass $checkout_ui_us;
    }

    location ~ ^/compra {
        proxy_pass $checkout_ui_compra_us;
    }

    #location /pagos {
    #    proxy_pass $checkout_ui_payments_us;
    #}
    #----Compumundo---

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

   location ~ ^/2007/sucursales.php$ {
        return 301 https://www.compumundo.com.ar/sucursales;
    }

    location ~ ^/(seguros|sucursales|god-of-war|comparador-productos|hotsale|cybermondaySuscriptionService|app|momento-compumundo|hp-ink|hp-omen|aerolineas-plus) {
        include /etc/nginx/includes/https;
        proxy_pass $landings_fe_us;
    }

    location /services/feeds {
        include /etc/nginx/env.conf;
        proxy_pass $product_core_us;
    }

    #location /service-worker.js {
    #    include /etc/nginx/env.conf;
    #    proxy_pass $normandia_us;
    #}

    location /de-que-lado-estas {
        proxy_pass $home_fe_us?home_name=gamer&draft=false;
    }

    location /listado/cybermonday- {
       return 302 https://www.compumundo.com.ar$is_args$args;
    }

    location /listado/cyber- {
       return 302 https://www.compumundo.com.ar$is_args$args;
    } 

    #location /electrofest {
    #   return 302 https://www.compumundo.com.ar$is_args$args;
    #}

    location /cybermonday-gracias-suscripcion {
       proxy_pass $landings_fe_us;
    }

    #location /catalogo-online {
    #    proxy_set_header Host static-sites.garbarino.com;
    #    location = /catalogo-online {
    #            rewrite ^(.*) https://${host}/catalogo-online/index.html permanent;
    #    }
    #    proxy_pass $aws_sss_us;
    #}
}

server {
    listen 80;
    server_name staging.compumundo.com;
    location / {
        rewrite ^ https://staging.compumundo.com.ar$request_uri permanent;
    }
    location ~ ^/user/password/recover {
       rewrite ^/user/password/recover(.*) https://compuprod.epi.ninja/user/password/recover$1 permanent;
    }
    location /carrito {
        rewrite ^ https://staging.compumundo.com.ar/carrito/ permanent;
    }

    location /compra {
        rewrite ^ https://staging.compumundo.com.ar/compra/ permanent;
    }

    location /pagos {
        rewrite ^ https://staging.compumundo.com.ar/pagos/ permanent;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name staging.compumundo.com.ar;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/includes/atacks;
    include /etc/nginx/fe/*.staging/*.conf;
    #include /etc/nginx/compu-no-pwa/*.ci/*.conf;
    #include /etc/nginx/compu-no-pwa/product.compu/locations.conf;
    #include /etc/nginx/compu-no-pwa/home.compu/locations.conf;
    #include /etc/nginx/compu-no-pwa/listing.compu/locations.conf;
    #include /etc/nginx/fe/normandia.ci/locations.conf;
    #include /etc/nginx/fe/my-account.ci/locations.conf;
    #include /etc/nginx/fe/newlandings.ci/locations.conf;
    #include /etc/nginx/fe/prelanding.staging/location.conf;

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

	location /ayuda {
		rewrite ^/ayuda/?(.*) /$1 break;
		proxy_pass $cac_frontend_us;
	}

    location /techgo {
        #proxy_pass $landings_fe_us;
        return 301 $scheme://techgo-staging.compumundo.com.ar;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/categorias {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    # New Compumundo Checkout redirects Staging.
    location ~ ^/(carrito|compra|pagos) {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $checkout_ui_us;
    }

    location / {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

    location ~ ^/(trabaja-en-compumundo|seguros|sucursales|god-of-war|cybermonday) {
        proxy_pass $landings_fe_us;
    }

    location /comparador-productos {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location /hotsale {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location ~ "^/hotsale$" {
        include /etc/nginx/env.conf;
        proxy_pass $home_fe_us/;
    }

    location /services/feeds {
        include /etc/nginx/env.conf;
        proxy_pass $product_core_us;
    }

    location /iphone7 {
        return 301 $scheme://staging.compumundo.com.ar/productos/iphone/8046;
    }

    #location /dia-del-nino  {
    #    return 301 https://staging.compumundo.com.ar$is_args$args;
    #}

    location /cybermonday-gracias-suscripcion {
       proxy_pass $landings_fe_us;
    }
}

#Ficha Compumundo CI
server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name ci.compumundo.com;

    location / {
        rewrite ^ https://ci.compumundo.com.ar$request_uri permanent;
    }

    location /carrito {
        rewrite ^ https://ci.compumundo.com.ar/carrito/ permanent;
    }

    location /compra {
        rewrite ^ https://ci.compumundo.com.ar/compra/ permanent;
    }

    location /pagos {
        rewrite ^ https://ci.compumundo.com.ar/pagos/ permanent;
    }

    #location /listado/back-to-school/cabh {
    #    return 301 https://ci.compumundo.com.ar;
    #}

    location /listado/ofertas-led-y-smart-tv-solo-por-hoy {
        return 301 https://staging.compumundo.com.ar;
    }

    location ~ ^/(ofertas-descuentos-online|12-cuotas-sin-interes|18-cuotas-sin-interes) {
        return 301 https://staging.compumundo.com.ar;
    }



}

#Seguros
server {
    listen 80;
    server_name insurance-ci.compumundo.com.ar seguros.compumundo.com.ar;
    set $webstore compumundo;
    include /etc/nginx/includes/headers;
    include /etc/nginx/proxy_env.conf;
    location / {
        proxy_pass $landings_fe_us/seguros$request_uri;
    }
}

server {
    listen 80;
    server_name *.techgo.com.ar ;
    location / {
        return 301  https://www.techgo.com.ar$request_uri;
    }
}

#Techgo Canonical
server {
    listen 80;
    include /etc/nginx/proxy_env.conf;
    server_name www.techgo.com.ar;
    include /etc/nginx/includes/headers;

    location / {
        proxy_set_header Host techgo.compumundo.com.ar.s3-website-us-east-1.amazonaws.com;
        proxy_pass $techgo_us;
    }

    location /services/contact {
        proxy_ssl_server_name on;
        proxy_set_header Host 36k4cdipd0.execute-api.us-east-1.amazonaws.com;
        proxy_pass https://36k4cdipd0.execute-api.us-east-1.amazonaws.com/ci/techGoContactForm;
    }

     location /services/subscribe {
        proxy_ssl_server_name on;
        proxy_set_header Host 36k4cdipd0.execute-api.us-east-1.amazonaws.com;
        proxy_pass https://36k4cdipd0.execute-api.us-east-1.amazonaws.com/ci/techGoSubscriptionForm;
    }
}

server {
    include /etc/nginx/env.conf;
    include /etc/nginx/proxy_env.conf;

    listen 80;
    server_name ci.compumundo.com.ar features.compumundo.com.ar features2.compumundo.com.ar;
    set $webstore Compumundo;

    include /etc/nginx/includes/headers;
    include /etc/nginx/includes/security;
    include /etc/nginx/includes/atacks;
    #include /etc/nginx/compu-no-pwa/*.ci/locations.conf;
    #include /etc/nginx/compu-no-pwa/product.compu/locations.conf;
    #include /etc/nginx/compu-no-pwa/home.compu/locations.conf;
    #include /etc/nginx/compu-no-pwa/listing.compu/locations.conf;
    #include /etc/nginx/compu-pwa/*.ci/locations.conf;
    #include /etc/nginx/fe/normandia.ci/locations.conf;
    #include /etc/nginx/fe/my-account.ci/locations.conf;
    #include /etc/nginx/fe/newlandings.ci/locations.conf;
    include /etc/nginx/fe/*.ci/*.conf;

    location /user/password/change {
        proxy_pass $epi_api_us;
    }

    location ~ ^/marcas$ {
        include /etc/nginx/env.conf;
        proxy_pass $landings_fe_us;
    }

    location ~ ^/categorias {
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    # New Compumundo Checkout redirects CI.
    #location ~ ^/(carrito|compra|pagos) {
        #include /etc/nginx/includes/https;

        #include /etc/nginx/includes/rewrites;
        #include /etc/nginx/includes/compu-rewrites;

	#if ($host = features.compumundo.com.ar) {
        #	proxy_pass $checkout_ui_features_us;
        #	break;
    	#}

    	#if ($host = features2.compumundo.com.ar) {
        #	proxy_pass $checkout_ui_features2_us;
        #	break;
    	#}

#        proxy_pass $checkout_ui_us;
#    }

    location / {
        # include /etc/nginx/includes/prerender;
        include /etc/nginx/includes/https;

        include /etc/nginx/includes/rewrites;
        include /etc/nginx/includes/compu-rewrites;
        proxy_pass $epi_ui_us;
    }

    location ~ ^/(admin|sg|api) {
        include /etc/nginx/env.conf;

        include /etc/nginx/security/*-ips.conf;

        deny all;

        proxy_pass $epi_api_us;
    }

    location /services/ {
        include /etc/nginx/env.conf;
        proxy_pass $epi_api_us;
    }

    # This resource is required by Mobile Apps and must be mounted on www.garbarino.com
    location /.well-known {
        proxy_pass $mapi_core_us;
    }

 	location /ayuda {
 		rewrite ^/ayuda/?(.*) /$1 break;
 		proxy_pass $cac_frontend_us;
 	}

    location /apple-app-site-association {
        proxy_pass $mapi_core_us;
    }

    location ~ ^/2007/sucursales.php$ {
        return 301 https://ci.compumundo.com.ar/sucursales;
    }

    location ~ ^/(momento-compumundo|hp-omen|hp-ink|aerolineas-plus|seguros|sucursales|god-of-war|app|trabaja-en-compumundo|hotsale|comparador-productos|cybermonday) {
        proxy_pass $landings_fe_us;
    }

    location /services/feeds {
        include /etc/nginx/env.conf;
        set $xservice product-core;
        proxy_pass $product_core_us;
    }
    
    location /listado/cyber- {
	    return 302 https://ci.compumundo.com.ar$is_args$args;
    }

    location /listado/cybermonday- {
       return 302 https://ci.compumundo.com.ar$is_args$args;
    }

    location /samsung-blue-days {
       return 301 https://ci.compumundo.com.ar/listado/samsung-blue-days/atvr;
    }

    #location /electrofest {
    #   return 302 https://ci.compumundo.com.ar;
    #}
}
