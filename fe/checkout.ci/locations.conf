location /reactcart {
    include /etc/nginx/includes/https;

    set $x_header "";

    if ($host = ci.compumundo.com.ar) {
        set $x_header "cart-ui-ci.compumundo.com.ar.s3-website-us-east-1.amazonaws.com";
        proxy_pass http://cart-ui-ci.compumundo.com.ar.s3-website-us-east-1.amazonaws.com;
        break;
    }
    
    if ($host = ci.garbarino.com) {
        set $x_header "cart-ui-ci.garbarino.com.s3-website-us-east-1.amazonaws.com";
        proxy_pass http://cart-ui-ci.garbarino.com.s3-website-us-east-1.amazonaws.com;
        break;
    }

    proxy_set_header Host $x_header
}

location /reactcart/error {
    proxy_set_header Host cart-ui-ci.garbarino.com.s3-website-us-east-1.amazonaws.com;
    proxy_pass http://cart-ui-ci.garbarino.com.s3-website-us-east-1.amazonaws.com;
}

location /reactcart/api/ {
    include /etc/nginx/includes/https;
    rewrite ^/reactcart/(.*) $1 break;
    proxy_pass $cart_ui_us/$1;
}


location /nuevo_carrito/ {

    include /etc/nginx/includes/https;

    rewrite ^/nuevo_carrito/(.*) /carrito/$1 break;

    if ($host = features.garbarino.com) {
	proxy_pass $checkout_ui_features_us;
        break;
    }

    if ($host = features2.garbarino.com) {
	proxy_pass $checkout_ui_features2_us;
        break;
    }
	proxy_pass $checkout_ui_us;
}

#location /nuevo_carrito/nuevo_carrito {
#	rewrite ^ https://$host/nuevo_carrito/ permanent;
#}

location ~ ^/carrito/c_.* {
    include /etc/nginx/includes/https;
    if ($host = features.garbarino.com) {
	proxy_pass $checkout_ui_features_us;
        break;
    }
    if ($host = features2.garbarino.com) {
	proxy_pass $checkout_ui_features2_us;
        break;
    }
	proxy_pass $checkout_ui_us;
}

location ~ ^/carrito/(setWarranty|sendCart|deleteProductFromCart|updateItemQuantity|getCartStatus|summary|garex) {
    if ($host = features.garbarino.com) {
	proxy_pass $checkout_ui_features_us;
        break;
    }	

    if ($host = features2.garbarino.com) {
	proxy_pass $checkout_ui_features2_us;
        break;
    }	
	proxy_pass $checkout_ui_us;
}

location /carrito/vendedor {
    if ($host = features.garbarino.com) {
	proxy_pass $checkout_ui_features_us;
        break;
    }

    if ($host = features2.garbarino.com) {
	proxy_pass $checkout_ui_features2_us;
        break;
    }	
    proxy_pass $checkout_ui_us;
}

location ~ ^/compra/ {
    if ($host = features.garbarino.com) {
	proxy_pass $checkout_ui_features_us;
        break;
    }

    if ($host = features2.garbarino.com) {
	proxy_pass $checkout_ui_features2_us;
        break;
    }	
	proxy_pass $checkout_ui_compra_us;
}

location ~ ^/carrito$ {
	include /etc/nginx/includes/https;

    rewrite ^ https://$host/carrito/ permanent;
}

location ~ ^/carrito/$ {
    include /etc/nginx/includes/https;
    set $where_to_go $pwa_us;

    if ($http_cookie ~ "gb_pwa_cart=false"){
        set $where_to_go $checkout_ui_us;
    }

    if ($ua_device ~ desktop){
        set $where_to_go $checkout_ui_us;
    }

    #if ($ua_device ~ tablet){
    #    set $where_to_go $checkout_ui_us;
    #}
    
    if ($arg_producto){
        set $where_to_go $checkout_ui_us;
    }
    
    if ($host = features.garbarino.com) {
	set $where_to_go $checkout_ui_features_us;
        break;
    }

    if ($host = features2.garbarino.com) {
	set $where_to_go $checkout_ui_features2_us;
        break;
    }

    proxy_pass $where_to_go;
}

location /pagos {
    if ($host = features.garbarino.com) {
	proxy_pass $checkout_ui_features_us;
        break;
    }

    if ($host = features2.garbarino.com) {
	proxy_pass $checkout_ui_features2_us;
        break;
    }	
    proxy_pass $checkout_ui_payments_us;
}

location /payments {
    proxy_pass $checkout_ui_payments_us;    
}

location /carrito/error {
    proxy_pass $checkout_ui_us;    
}

location /carrito/reset {
    proxy_pass $checkout_ui_us;
}
